<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <meta http-equiv="Content-type">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="https://code.jquery.com/ui/1.12.0/themes/base/jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="/node_modules/line-chart/dist/css/line-chart.css">
    <link rel="stylesheet" type="text/css" href="/css/app.css">
    <script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script type="text/javascript" src="/node_modules/line-chart/dist/line-chart.js"></script>
	<title>Static</title>
	<script type="text/javascript">

		$(document).ready(function () {

			/*----------------------------------------------------------------------------------
			* Chart making functions
			**---------------------------------------------------------------------------------*/

			// Draw a chart
			function makeChart(selection, data) {
				var linechart = lineChart.chart(selection, 'temp-chart')
					.ratio(4,2)
					.data([data])
					.scaleX('time')
					.xLabel('Time (s)')
					.axisPadding({y:1})
					.yLabel('Temperature (degrees C)')
					.title('Temperature vs Time')
					.grid(true)
					.render()
			}

			function newChart(url) {
				// Get data with Ajax call
				$.getJSON(url, function (data) {

					// Convert date values in date objects
					// Map value to x and y
					var new_data = data.rows.map(function (value) {
						return {
							x: new Date(value.date),
							y: value.temperature
						}
					})

					// Remove old chart
					selection.selectAll('*').remove()
					// Add chart with new data
					makeChart(selection, new_data)

				});
			}

			/*----------------------------------------------------------------------------------
			* Load default chart
			**---------------------------------------------------------------------------------*/
			
			// Select chart host element
			var selection = d3.select("div.chart")

			// Data is stored at GMT on server
			// When conerted back to Date object using new Date() in browser it will be correct.
			// Always Send ISO8601 to server!

			// Default to get data from an hour ago till now
			var date_now = new Date();
			var date_old = new Date()
			date_old.setHours(date_now.getHours()-10);

			// Set data URL
			var url = '/temp/datetime?start=' + date_old.toISOString() + '&end=' + date_now.toISOString();
			newChart(url);
			
			/*----------------------------------------------------------------------------------
			* User defined chart
			**---------------------------------------------------------------------------------*/
			
		$(function() {
			$( "#datepicker" ).datepicker();
		});


		});

	</script>
</head>
<body>
	<div class="overflow-wrapper">
		{{> nav}}
	</div>

	<div class="chart"></div>
	<p>Start: <input type="text" id="start_date" value="today" placeholder="Today"></p>
	<p>End: <input type="text" id="start_date"></p>
</body>
</html>